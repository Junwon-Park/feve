<template>
  <div style="margin-left:18%; max-width:60%; margin-bottom:10%">
    <mypage-simple-user-info :userInfo="userInfo" style="width:15rem;"/>

    <h2 class="mt-20 font-bold">구매 내역</h2>
    <mypage-simple-count-list :counts="buyCounts"/>

    <h2 class="font-bold">판매 내역</h2>
    <mypage-simple-count-list :counts="sellCounts"/>

    <h2 class="font-bold">관심 상품</h2>
    <mypage-simple-favorite-list :items="favoriteProducts"/>

    <img src="http://localhost:3000/product/product-lego5.jpg">
    
    <!-- <img id="img1" src="testImage"> -->
  </div>
</template>

<script>
import MypageSimpleUserInfo from '@/components/Cards/Mypage/MypageSimpleUserInfo.vue';
import MypageSimpleCountList from '@/components/Cards/Mypage/MypageSimpleCountList.vue';
import MypageSimpleFavoriteList from '@/components/Cards/Mypage/MypageSimpleFavoriteList.vue';

export default {
  components: {
    MypageSimpleUserInfo,
    MypageSimpleCountList,
    MypageSimpleFavoriteList,
  },
  data() {
    return {
      userInfo:{
        USER_NAME:'', 
        USER_MAIL:'',
      },
      buyCounts:[],
      sellCounts:[],
      favoriteProducts: [
        {
          PRODUCT_BRAND:'',
          PRODUCT_NAME:'',
          PRODUCT_ORIPRICE:'',
          PRODUCT_PIC:'',
        },
      ],
      testImage:''
    }
  },
  created() {
    this.getSimpleUserInfo();
    this.getBuyCounts();
    this.getSellCounts();
    this.getSimpleFavorites();
    //this.getImage();
  },
  methods: {
    getSimpleUserInfo(){
      this.$axios.post('http://localhost:8080/mypage/getSimpleUserInfo', {
        USER_KEY : '1', //로그인과 연동시키기
      })
      .then((result) => {
        // console.log(result.data);
        this.userInfo = result.data;
        // console.log(this.userInfo);
      })
      .catch((error) => {
        console.log(error);
      })
    },
    getBuyCounts(){
      this.$axios.post('http://localhost:8080/mypage/getbuyCounts', {
        USER_KEY : '1', //로그인과 연동시키기
      })
      .then((result) => {
        // console.log(result.data);
        this.buyCounts = result.data;
      })
      .catch((error) => {
        console.log(error);
      })
    },
    getSellCounts(){
      this.$axios.post('http://localhost:8080/mypage/getsellCounts', {
        USER_KEY : '1', //로그인과 연동시키기
      })
      .then((result) => {
        // console.log(result.data);
        this.sellCounts = result.data;
      })
      .catch((error) => {
        console.log(error);
      })
    },
    getSimpleFavorites(){
      this.$axios.post('http://localhost:8080/mypage/getSimpleFavorites', {
        USER_KEY : '1', //로그인과 연동시키기
      })
      .then((result) => {
        //console.log("getSimpleFavorites.result: ", result);
        this.favoriteProducts = result.data;
        //console.log("getSimpleFavorites.favoriteProducts: ", this.favoriteProducts);
      })
      .catch((error) => {
        console.log(error);
      })
    },

    getImage(){
      this.$axios.get('http://localhost:8080/getImage', {
        imageName:'product-lego7.jpg'
      })
      .then((result) => {
        console.log("getImage.result: ", result);
        console.log("getImage.result.data: ", result.data.toString('base64'));
        // const blob = new Blob(result.data);
        // this.testImage = URL.createObjectURL(blob);
        // console.log("getImage.testImage: ", this.testImage);

        // var img = document.getElementById('img1');
        // img.src = 'data:image/jpeg;base64,' + btoa(result.data);
        //document.body.appendChild(img);

        var data = '';
          result.setEncoding('binary');
            result.on('data', function(chunk) { 
              data += chunk;
          });
          result.on('end', function() {
              result.rawBody = data;
          });
        console.log("finalData: ", data);
        // this.testImage = 'data:image/png;base64,' + result.data;
      })       
      .catch((error) => {
        console.log(error);
      })
    }
  }
};

</script>
